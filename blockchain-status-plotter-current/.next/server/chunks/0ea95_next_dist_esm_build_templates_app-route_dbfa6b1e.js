module.exports=[27155,e=>{"use strict";let t,s,n,r;var a,i,o,l,c,h,u,d,p,f,m,g,y,w,_,b,v,x,A,S,$,R,I,O,k,E,P,C,T,N,j,M,D,L,B,q,W,U,F,H,X,K,J,V,z,G,Q,Y,Z,ee,et,es,en,er,ea,ei,eo,el,ec,eh,eu,ed,ep,ef,em,eg,ey,ew,e_,eb,ev,ex,eA,eS,e$,eR,eI=e.i(4245),eO=e.i(34275),ek=e.i(96078),eE=e.i(16652),eP=e.i(97116),eC=e.i(29130),eT=e.i(15862),eN=e.i(33177),ej=e.i(6962),eM=e.i(7359),eD=e.i(34907),eL=e.i(51539),eB=e.i(12851),eq=e.i(14844),eW=e.i(14484),eU=e.i(76986),eF=e.i(93695);e.i(58379);var eH=e.i(89595),eX=e.i(62281),eK=e.i(97040);function eJ(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function eV(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let ez=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return ez=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function eG(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eQ=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eY extends Error{}class eZ extends eY{constructor(e,t,s,n){super(`${eZ.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new e1({message:s,cause:eQ(t)});let r=t?.error;return 400===e?new e4(e,r,s,n):401===e?new e3(e,r,s,n):403===e?new e5(e,r,s,n):404===e?new e8(e,r,s,n):409===e?new e6(e,r,s,n):422===e?new e9(e,r,s,n):429===e?new e7(e,r,s,n):e>=500?new te(e,r,s,n):new eZ(e,r,s,n)}}class e0 extends eZ{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class e1 extends eZ{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class e2 extends e1{constructor({message:e}={}){super({message:e??"Request timed out."})}}class e4 extends eZ{}class e3 extends eZ{}class e5 extends eZ{}class e8 extends eZ{}class e6 extends eZ{}class e9 extends eZ{}class e7 extends eZ{}class te extends eZ{}class tt extends eY{constructor(){super("Could not parse response content as the length limit was reached")}}class ts extends eY{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class tn extends Error{constructor(e){super(e)}}let tr=/^[a-z][a-z0-9+.-]*:/i,ta=e=>(ta=Array.isArray)(e),ti=ta;function to(e){return"object"!=typeof e?{}:e??{}}function tl(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let tc=e=>new Promise(t=>setTimeout(t,e)),th="6.9.1",tu=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",td=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function tp(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function tf(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return tp({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function tm(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function tg(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let ty=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),tw="RFC3986",t_=e=>String(e),tb={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:t_},tv=(e,t)=>(tv=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),tx=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function tA(e,t){if(ta(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let tS={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},t$=function(e,t){Array.prototype.push.apply(e,ta(t)?t:[t])},tR={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===s)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let e=0;e<a.length;e+=1024){let t=a.length>=1024?a.slice(e,e+1024):a,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=tx[n];continue}if(n<2048){s[s.length]=tx[192|n>>6]+tx[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=tx[224|n>>12]+tx[128|n>>6&63]+tx[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=tx[240|n>>18]+tx[128|n>>12&63]+tx[128|n>>6&63]+tx[128|63&n]}i+=s.join("")}return i},encodeValuesOnly:!1,format:tw,formatter:t_,indices:!1,serializeDate:e=>(s??(s=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},tI={};function tO(e){let t;return(n??(n=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tk(e){let t;return(r??(r=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class tE{constructor(){a.set(this,void 0),i.set(this,void 0),eJ(this,a,new Uint8Array,"f"),eJ(this,i,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tO(e):e;eJ(this,a,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([eV(this,a,"f"),s]),"f");let n=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eV(this,a,"f"),eV(this,i,"f")));){if(t.carriage&&null==eV(this,i,"f")){eJ(this,i,t.index,"f");continue}if(null!=eV(this,i,"f")&&(t.index!==eV(this,i,"f")+1||t.carriage)){n.push(tk(eV(this,a,"f").subarray(0,eV(this,i,"f")-1))),eJ(this,a,eV(this,a,"f").subarray(eV(this,i,"f")),"f"),eJ(this,i,null,"f");continue}let e=null!==eV(this,i,"f")?t.preceding-1:t.preceding,s=tk(eV(this,a,"f").subarray(0,e));n.push(s),eJ(this,a,eV(this,a,"f").subarray(t.index),"f"),eJ(this,i,null,"f")}return n}flush(){return eV(this,a,"f").length?this.decode("\n"):[]}}a=new WeakMap,i=new WeakMap,tE.NEWLINE_CHARS=new Set(["\n","\r"]),tE.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let tP={off:0,error:200,warn:300,info:400,debug:500},tC=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(tP,e))return e;tD(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(tP))}`)}};function tT(){}function tN(e,t,s){return!t||tP[e]>tP[s]?tT:t[e].bind(t)}let tj={error:tT,warn:tT,info:tT,debug:tT},tM=new WeakMap;function tD(e){let t=e.logger,s=e.logLevel??"off";if(!t)return tj;let n=tM.get(t);if(n&&n[0]===s)return n[1];let r={error:tN("error",t,s),warn:tN("warn",t,s),info:tN("info",t,s),debug:tN("debug",t,s)};return tM.set(t,[s,r]),r}let tL=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class tB{constructor(e,t,s){this.iterator=e,o.set(this,void 0),this.controller=t,eJ(this,o,s,"f")}static fromSSEResponse(e,t,s){let n=!1,r=s?tD(s):console;async function*a(){if(n)throw new eY("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(let n of tq(e,t))if(!s){if(n.data.startsWith("[DONE]")){s=!0;continue}if(null!==n.event&&n.event.startsWith("thread.")){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new eZ(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}else{let t;try{t=JSON.parse(n.data)}catch(e){throw r.error("Could not parse message into JSON:",n.data),r.error("From chunk:",n.raw),e}if(t&&t.error)throw new eZ(void 0,t.error,void 0,e.headers);yield t}}s=!0}catch(e){if(eG(e))return;throw e}finally{s||t.abort()}}return new tB(a,t,s)}static fromReadableStream(e,t,s){let n=!1;async function*r(){let t=new tE;for await(let s of tm(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tB(async function*(){if(n)throw new eY("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{for await(let t of r())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(eG(e))return;throw e}finally{e||t.abort()}},t,s)}[(o=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new tB(()=>n(e),this.controller,eV(this,o,"f")),new tB(()=>n(t),this.controller,eV(this,o,"f"))]}toReadableStream(){let e,t=this;return tp({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=tO(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tq(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eY("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eY("Attempted to iterate over a response with no body")}let s=new tU,n=new tE;for await(let t of tW(tm(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tW(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?tO(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tU{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let s;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,a]=-1!==(s=(t=e).indexOf(":"))?[t.substring(0,s),":",t.substring(s+1)]:[t,"",""];return a.startsWith(" ")&&(a=a.substring(1)),"event"===n?this.event=a:"data"===n&&this.data.push(a),null}}async function tF(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:a}=t,i=await (async()=>{if(t.options.stream)return(tD(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):tB.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?tH(await s.json(),s):await s.text()})();return tD(e).debug(`[${n}] response parsed`,tL({retryOfRequestLogID:r,url:s.url,status:s.status,body:i,durationMs:Date.now()-a})),i}function tH(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class tX extends Promise{constructor(e,t,s=tF){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,l.set(this,void 0),eJ(this,l,e,"f")}_thenUnwrap(e){return new tX(eV(this,l,"f"),this.responsePromise,async(t,s)=>tH(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eV(this,l,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}l=new WeakMap;class tK{constructor(e,t,s,n){c.set(this,void 0),eJ(this,c,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eY("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eV(this,c,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(c=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tJ extends tX{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tF(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tV extends tK{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tz extends tK{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...to(this.options.query),after:t}}:null}}class tG extends tK{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...to(this.options.query),after:e}}:null}}let tQ=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tY(e,t,s){return tQ(),new File(e,t??"unknown_file",s)}function tZ(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let t0=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],t1=async(e,t)=>t8(e.body)?{...e,body:await t3(e.body,t)}:e,t2=async(e,t)=>({...e,body:await t3(e.body,t)}),t4=new WeakMap,t3=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=t4.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return t4.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>t6(s,e,t))),s},t5=e=>e instanceof Blob&&"name"in e,t8=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||t0(e)||t5(e)))return!0;if(Array.isArray(e))return e.some(t8);if(e&&"object"==typeof e){for(let t in e)if(t8(e[t]))return!0}return!1},t6=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tY([await s.blob()],tZ(s)));else if(t0(s))e.append(t,tY([await new Response(tf(s)).blob()],tZ(s)));else if(t5(s))e.append(t,s,tZ(s));else if(Array.isArray(s))await Promise.all(s.map(s=>t6(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>t6(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},t9=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function t7(e,t,s){let n,r;if(tQ(),null!=(n=e=await e)&&"object"==typeof n&&"string"==typeof n.name&&"number"==typeof n.lastModified&&t9(n))return e instanceof File?e:tY([await e.arrayBuffer()],e.name);if(null!=(r=e)&&"object"==typeof r&&"string"==typeof r.url&&"function"==typeof r.blob){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tY(await se(n),t,s)}let a=await se(e);if(t||(t=tZ(e)),!s?.type){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tY(a,t,s)}async function se(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(t9(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(t0(e))for await(let s of e)t.push(...await se(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class st{constructor(e){this._client=e}}function ss(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let sn=Object.freeze(Object.create(null)),sr=((e=ss)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,a=[],i=t.reduce((t,n,i)=>{/[?#]/.test(n)&&(r=!0);let o=s[i],l=(r?encodeURIComponent:e)(""+o);return i!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??sn)??sn)?.toString)&&(l=o+"",a.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(i===s.length?"":l)},""),o=i.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(o));)a.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(a.sort((e,t)=>e.start-t.start),a.length>0){let e=0,t=a.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eY(`Path parameters result in path with invalid segments:
${a.map(e=>e.error).join("\n")}
${i}
${t}`)}return i})(ss);class sa extends st{list(e,t={},s){return this._client.getAPIList(sr`/chat/completions/${e}/messages`,tz,{query:t,...s})}}function si(e){return void 0!==e&&"function"in e&&void 0!==e.function}function so(e){return e?.$brand==="auto-parseable-response-format"}function sl(e){return e?.$brand==="auto-parseable-tool"}function sc(e,t){let s=e.choices.map(e=>{var s,n;if("length"===e.finish_reason)throw new tt;if("content_filter"===e.finish_reason)throw new ts;return su(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var s,n;let r;return s=t,n=e,r=s.tools?.find(e=>si(e)&&e.function?.name===n.function.name),{...n,function:{...n.function,parsed_arguments:sl(r)?r.$parseRaw(n.function.arguments):r?.function.strict?JSON.parse(n.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,n=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(n):JSON.parse(n):null):null}}});return{...e,choices:s}}function sh(e){return!!so(e.response_format)||(e.tools?.some(e=>sl(e)||"function"===e.type&&!0===e.function.strict)??!1)}function su(e){for(let t of e||[])if("function"!==t.type)throw new eY(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let sd=e=>e?.role==="assistant",sp=e=>e?.role==="tool";class sf{constructor(){h.add(this),this.controller=new AbortController,u.set(this,void 0),d.set(this,()=>{}),p.set(this,()=>{}),f.set(this,void 0),m.set(this,()=>{}),g.set(this,()=>{}),y.set(this,{}),w.set(this,!1),_.set(this,!1),b.set(this,!1),v.set(this,!1),eJ(this,u,new Promise((e,t)=>{eJ(this,d,e,"f"),eJ(this,p,t,"f")}),"f"),eJ(this,f,new Promise((e,t)=>{eJ(this,m,e,"f"),eJ(this,g,t,"f")}),"f"),eV(this,u,"f").catch(()=>{}),eV(this,f,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eV(this,h,"m",x).bind(this))},0)}_connected(){this.ended||(eV(this,d,"f").call(this),this._emit("connect"))}get ended(){return eV(this,w,"f")}get errored(){return eV(this,_,"f")}get aborted(){return eV(this,b,"f")}abort(){this.controller.abort()}on(e,t){return(eV(this,y,"f")[e]||(eV(this,y,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eV(this,y,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(eV(this,y,"f")[e]||(eV(this,y,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eJ(this,v,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eJ(this,v,!0,"f"),await eV(this,f,"f")}_emit(e,...t){if(eV(this,w,"f"))return;"end"===e&&(eJ(this,w,!0,"f"),eV(this,m,"f").call(this));let s=eV(this,y,"f")[e];if(s&&(eV(this,y,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eV(this,v,"f")||s?.length||Promise.reject(e),eV(this,p,"f").call(this,e),eV(this,g,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eV(this,v,"f")||s?.length||Promise.reject(e),eV(this,p,"f").call(this,e),eV(this,g,"f").call(this,e),this._emit("end")}}_emitFinal(){}}u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,h=new WeakSet,x=function(e){if(eJ(this,_,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new e0),e instanceof e0)return eJ(this,b,!0,"f"),this._emit("abort",e);if(e instanceof eY)return this._emit("error",e);if(e instanceof Error){let t=new eY(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eY(String(e)))};class sm extends sf{constructor(){super(...arguments),A.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),sp(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(sd(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eY("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eV(this,A,"m",S).call(this)}async finalMessage(){return await this.done(),eV(this,A,"m",$).call(this)}async finalFunctionToolCall(){return await this.done(),eV(this,A,"m",R).call(this)}async finalFunctionToolCallResult(){return await this.done(),eV(this,A,"m",I).call(this)}async totalUsage(){return await this.done(),eV(this,A,"m",O).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=eV(this,A,"m",$).call(this);t&&this._emit("finalMessage",t);let s=eV(this,A,"m",S).call(this);s&&this._emit("finalContent",s);let n=eV(this,A,"m",R).call(this);n&&this._emit("finalFunctionToolCall",n);let r=eV(this,A,"m",I).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eV(this,A,"m",O).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eV(this,A,"m",k).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(sc(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:a,...i}=t,o="string"!=typeof r&&"function"===r.type&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(sl(e)){if(!e.$callback)throw new eY("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),h={};for(let e of c)"function"===e.type&&(h[e.function.name||e.function.function.name]=e.function);let u="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...i,tool_choice:r,tools:u,messages:[...this.messages]},s),a=t.choices[0]?.message;if(!a)throw new eY("missing message in ChatCompletion response");if(!a.tool_calls?.length)break;for(let e of a.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:a}=e.function,i=h[r];if(i){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(h).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof i.parse?await i.parse(a):a}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await i.function(t,this),c=eV(this,A,"m",E).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}A=new WeakSet,S=function(){return eV(this,A,"m",$).call(this).content??null},$=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(sd(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eY("stream ended without producing a ChatCompletionMessage with role=assistant")},R=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sd(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},I=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sp(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},O=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},k=function(e){if(null!=e.n&&e.n>1)throw new eY("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},E=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class sg extends sm{static runTools(e,t,s){let n=new sg,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),sd(e)&&e.content&&this._emit("content",e.content)}}let sy=511;class sw extends Error{}class s_ extends Error{}let sb=e=>(function(e,t=sy){var s,n;let r,a,i,o,l,c,h,u,d,p;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return s=e.trim(),n=t,r=s.length,a=0,i=e=>{throw new sw(`${e} at position ${a}`)},o=e=>{throw new s_(`${e} at position ${a}`)},l=()=>(p(),a>=r&&i("Unexpected end of input"),'"'===s[a])?c():"{"===s[a]?h():"["===s[a]?u():"null"===s.substring(a,a+4)||16&n&&r-a<4&&"null".startsWith(s.substring(a))?(a+=4,null):"true"===s.substring(a,a+4)||32&n&&r-a<4&&"true".startsWith(s.substring(a))?(a+=4,!0):"false"===s.substring(a,a+5)||32&n&&r-a<5&&"false".startsWith(s.substring(a))?(a+=5,!1):"Infinity"===s.substring(a,a+8)||128&n&&r-a<8&&"Infinity".startsWith(s.substring(a))?(a+=8,1/0):"-Infinity"===s.substring(a,a+9)||256&n&&1<r-a&&r-a<9&&"-Infinity".startsWith(s.substring(a))?(a+=9,-1/0):"NaN"===s.substring(a,a+3)||64&n&&r-a<3&&"NaN".startsWith(s.substring(a))?(a+=3,NaN):d(),c=()=>{let e=a,t=!1;for(a++;a<r&&('"'!==s[a]||t&&"\\"===s[a-1]);)t="\\"===s[a]&&!t,a++;if('"'==s.charAt(a))try{return JSON.parse(s.substring(e,++a-Number(t)))}catch(e){o(String(e))}else if(1&n)try{return JSON.parse(s.substring(e,a-Number(t))+'"')}catch(t){return JSON.parse(s.substring(e,s.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},h=()=>{a++,p();let e={};try{for(;"}"!==s[a];){if(p(),a>=r&&8&n)return e;let t=c();p(),a++;try{let s=l();Object.defineProperty(e,t,{value:s,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&n)return e;throw t}p(),","===s[a]&&a++}}catch(t){if(8&n)return e;i("Expected '}' at end of object")}return a++,e},u=()=>{a++;let e=[];try{for(;"]"!==s[a];)e.push(l()),p(),","===s[a]&&a++}catch(t){if(4&n)return e;i("Expected ']' at end of array")}return a++,e},d=()=>{if(0===a){"-"===s&&2&n&&i("Not sure what '-' is");try{return JSON.parse(s)}catch(e){if(2&n)try{if("."===s[s.length-1])return JSON.parse(s.substring(0,s.lastIndexOf(".")));return JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch(e){}o(String(e))}}let e=a;for("-"===s[a]&&a++;s[a]&&!",]}".includes(s[a]);)a++;a!=r||2&n||i("Unterminated number literal");try{return JSON.parse(s.substring(e,a))}catch(t){"-"===s.substring(e,a)&&2&n&&i("Not sure what '-' is");try{return JSON.parse(s.substring(e,s.lastIndexOf("e")))}catch(e){o(String(e))}}},p=()=>{for(;a<r&&" \n\r	".includes(s[a]);)a++},l()})(e,2^sy);class sv extends sm{constructor(e){super(),P.add(this),C.set(this,void 0),T.set(this,void 0),N.set(this,void 0),eJ(this,C,e,"f"),eJ(this,T,[],"f")}get currentChatCompletionSnapshot(){return eV(this,N,"f")}static fromReadableStream(e){let t=new sv(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new sv(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eV(this,P,"m",j).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))eV(this,P,"m",D).call(this,e);if(r.controller.signal?.aborted)throw new e0;return this._addChatCompletion(eV(this,P,"m",q).call(this))}async _fromReadableStream(e,t){let s,n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eV(this,P,"m",j).call(this),this._connected();let r=tB.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(eV(this,P,"m",q).call(this)),eV(this,P,"m",D).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new e0;return this._addChatCompletion(eV(this,P,"m",q).call(this))}[(C=new WeakMap,T=new WeakMap,N=new WeakMap,P=new WeakSet,j=function(){this.ended||eJ(this,N,void 0,"f")},M=function(e){let t=eV(this,T,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eV(this,T,"f")[e.index]=t),t},D=function(e){if(this.ended)return;let t=eV(this,P,"m",U).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=eV(this,P,"m",M).call(this,e);for(let t of(e.finish_reason&&(eV(this,P,"m",B).call(this,e),null!=n.current_tool_call_index&&eV(this,P,"m",L).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(eV(this,P,"m",B).call(this,e),null!=n.current_tool_call_index&&eV(this,P,"m",L).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):sS(s?.type))}}},L=function(e,t){if(eV(this,P,"m",M).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=eV(this,C,"f")?.tools?.find(e=>si(e)&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:sl(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else sS(s.type)},B=function(e){let t=eV(this,P,"m",M).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=eV(this,P,"m",W).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},q=function(){if(this.ended)throw new eY("stream has ended, this shouldn't happen");let e=eV(this,N,"f");if(!e)throw new eY("request ended without sending any chunks");return eJ(this,N,void 0,"f"),eJ(this,T,[],"f"),function(e,t){var s;let{id:n,choices:r,created:a,model:i,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...a})=>{if(!s)throw new eY(`missing finish_reason for choice ${n}`);let{content:i=null,function_call:o,tool_calls:l,...c}=t,h=t.role;if(!h)throw new eY(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eY(`missing function_call.arguments for choice ${n}`);if(!l)throw new eY(`missing function_call.name for choice ${n}`);return{...a,message:{content:i,function_call:{arguments:e,name:l},role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...a,index:n,finish_reason:s,logprobs:r,message:{...c,role:h,content:i,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:a,id:i,...o}=t,{arguments:l,name:c,...h}=r||{};if(null==i)throw new eY(`missing choices[${n}].tool_calls[${s}].id
${sx(e)}`);if(null==a)throw new eY(`missing choices[${n}].tool_calls[${s}].type
${sx(e)}`);if(null==c)throw new eY(`missing choices[${n}].tool_calls[${s}].function.name
${sx(e)}`);if(null==l)throw new eY(`missing choices[${n}].tool_calls[${s}].function.arguments
${sx(e)}`);return{...o,id:i,type:a,function:{...h,name:c,arguments:l}}})}}:{...a,message:{...c,content:i,role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:a,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&sh(t)?sc(s,t):{...s,choices:s.choices.map(e=>(su(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,eV(this,C,"f"))},W=function(){let e=eV(this,C,"f")?.response_format;return so(e)?e:null},U=function(e){var t,s,n,r;let a=eV(this,N,"f"),{choices:i,...o}=e;for(let{delta:i,finish_reason:l,index:c,logprobs:h=null,...u}of(a?Object.assign(a,o):a=eJ(this,N,{...o,choices:[]},"f"),e.choices)){let e=a.choices[c];if(e||(e=a.choices[c]={finish_reason:l,index:c,message:{},logprobs:h,...u}),h)if(e.logprobs){let{content:n,refusal:r,...a}=h;sA(a),Object.assign(e.logprobs,a),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},h);if(l&&(e.finish_reason=l,eV(this,C,"f")&&sh(eV(this,C,"f")))){if("length"===l)throw new tt;if("content_filter"===l)throw new ts}if(Object.assign(e,u),!i)continue;let{content:o,refusal:d,function_call:p,role:f,tool_calls:m,...g}=i;if(sA(g),Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&eV(this,P,"m",W).call(this)&&(e.message.parsed=sb(e.message.content))),m)for(let{index:t,id:s,type:n,function:a,...i}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,i),s&&(o.id=s),n&&(o.type=n),a&&(o.function??(o.function={name:a.name??"",arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let s=e.tools?.find(e=>si(e)&&e.function?.name===t.function.name);return si(s)&&(sl(s)||s?.function.strict||!1)}(eV(this,C,"f"),o)&&(o.function.parsed_arguments=sb(o.function.arguments)))}}return a},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tB(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sx(e){return JSON.stringify(e)}function sA(e){}function sS(e){}class s$ extends sv{static fromReadableStream(e){let t=new s$(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new s$(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class sR extends st{constructor(){super(...arguments),this.messages=new sa(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(sr`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(sr`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tz,{query:e,...t})}delete(e,t){return this._client.delete(sr`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new eY(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eY(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>sc(t,e))}runTools(e,t){return e.stream?s$.runTools(this._client,e,t):sg.runTools(this._client,e,t)}stream(e,t){return sv.createChatCompletion(this._client,e,t)}}sR.Messages=sa;class sI extends st{constructor(){super(...arguments),this.completions=new sR(this._client)}}sI.Completions=sR,e.s([],77383);let sO=Symbol("brand.privateNullableHeaders"),sk=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,a]of function*(e){let t;if(!e)return;if(sO in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():ti(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=ti(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===a?(t.delete(r),s.add(n)):(t.append(r,a),s.delete(n))}}return{[sO]:!0,values:t,nulls:s}};class sE extends st{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sk([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class sP extends st{create(e,t){return this._client.post("/audio/transcriptions",t2({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sC extends st{create(e,t){return this._client.post("/audio/translations",t2({body:e,...t,__metadata:{model:e.model}},this._client))}}class sT extends st{constructor(){super(...arguments),this.transcriptions=new sP(this._client),this.translations=new sC(this._client),this.speech=new sE(this._client)}}sT.Transcriptions=sP,sT.Translations=sC,sT.Speech=sE;class sN extends st{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(sr`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tz,{query:e,...t})}cancel(e,t){return this._client.post(sr`/batches/${e}/cancel`,t)}}class sj extends st{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(sr`/assistants/${e}`,{...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(sr`/assistants/${e}`,{body:t,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tz,{query:e,...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(sr`/assistants/${e}`,{...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sM extends st{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sD extends st{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sL extends st{constructor(){super(...arguments),this.sessions=new sM(this._client),this.transcriptionSessions=new sD(this._client)}}sL.Sessions=sM,sL.TranscriptionSessions=sD;class sB extends st{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:sk([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(sr`/chatkit/sessions/${e}/cancel`,{...t,headers:sk([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class sq extends st{retrieve(e,t){return this._client.get(sr`/chatkit/threads/${e}`,{...t,headers:sk([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",tG,{query:e,...t,headers:sk([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(sr`/chatkit/threads/${e}`,{...t,headers:sk([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},s){return this._client.getAPIList(sr`/chatkit/threads/${e}/items`,tG,{query:t,...s,headers:sk([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}}class sW extends st{constructor(){super(...arguments),this.sessions=new sB(this._client),this.threads=new sq(this._client)}}sW.Sessions=sB,sW.Threads=sq;class sU extends st{create(e,t,s){return this._client.post(sr`/threads/${e}/messages`,{body:t,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(sr`/threads/${n}/messages/${e}`,{...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(sr`/threads/${n}/messages/${e}`,{body:r,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(sr`/threads/${e}/messages`,tz,{query:t,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(sr`/threads/${n}/messages/${e}`,{...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sF extends st{retrieve(e,t,s){let{thread_id:n,run_id:r,...a}=t;return this._client.get(sr`/threads/${n}/runs/${r}/steps/${e}`,{query:a,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(sr`/threads/${n}/runs/${e}/steps`,tz,{query:r,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let sH=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sX extends sf{constructor(){super(...arguments),F.add(this),X.set(this,[]),K.set(this,{}),J.set(this,{}),V.set(this,void 0),z.set(this,void 0),G.set(this,void 0),Q.set(this,void 0),Y.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),es.set(this,void 0)}[(X=new WeakMap,K=new WeakMap,J=new WeakMap,V=new WeakMap,z=new WeakMap,G=new WeakMap,Q=new WeakMap,Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,F=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new H;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=tB.fromReadableStream(e,this.controller);for await(let e of n)eV(this,F,"m",en).call(this,e);if(n.controller.signal?.aborted)throw new e0;return this._addRun(eV(this,F,"m",er).call(this))}toReadableStream(){return new tB(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},i=await e.submitToolOutputs(t,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))eV(this,F,"m",en).call(this,e);if(i.controller.signal?.aborted)throw new e0;return this._addRun(eV(this,F,"m",er).call(this))}static createThreadAssistantStream(e,t,s){let n=new H;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return eV(this,ee,"f")}currentRun(){return eV(this,et,"f")}currentMessageSnapshot(){return eV(this,V,"f")}currentRunStepSnapshot(){return eV(this,es,"f")}async finalRunSteps(){return await this.done(),Object.values(eV(this,K,"f"))}async finalMessages(){return await this.done(),Object.values(eV(this,J,"f"))}async finalRun(){if(await this.done(),!eV(this,z,"f"))throw Error("Final run was not received.");return eV(this,z,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},a=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),a))eV(this,F,"m",en).call(this,e);if(a.controller.signal?.aborted)throw new e0;return this._addRun(eV(this,F,"m",er).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},i=await e.create(t,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))eV(this,F,"m",en).call(this,e);if(i.controller.signal?.aborted)throw new e0;return this._addRun(eV(this,F,"m",er).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(tl(t)&&tl(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!tl(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}H=sX,en=function(e){if(!this.ended)switch(eJ(this,ee,e,"f"),eV(this,F,"m",eo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eV(this,F,"m",eu).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eV(this,F,"m",ei).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eV(this,F,"m",ea).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},er=function(){if(this.ended)throw new eY("stream has ended, this shouldn't happen");if(!eV(this,z,"f"))throw Error("Final run has not been received");return eV(this,z,"f")},ea=function(e){let[t,s]=eV(this,F,"m",ec).call(this,e,eV(this,V,"f"));for(let e of(eJ(this,V,t,"f"),eV(this,J,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=eV(this,G,"f")){if(eV(this,Q,"f"))switch(eV(this,Q,"f").type){case"text":this._emit("textDone",eV(this,Q,"f").text,eV(this,V,"f"));break;case"image_file":this._emit("imageFileDone",eV(this,Q,"f").image_file,eV(this,V,"f"))}eJ(this,G,s.index,"f")}eJ(this,Q,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eV(this,G,"f")){let t=e.data.content[eV(this,G,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eV(this,V,"f"));break;case"text":this._emit("textDone",t.text,eV(this,V,"f"))}}eV(this,V,"f")&&this._emit("messageDone",e.data),eJ(this,V,void 0,"f")}},ei=function(e){let t=eV(this,F,"m",el).call(this,e);switch(eJ(this,es,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==eV(this,Y,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eV(this,Z,"f")&&this._emit("toolCallDone",eV(this,Z,"f")),eJ(this,Y,e.index,"f"),eJ(this,Z,t.step_details.tool_calls[e.index],"f"),eV(this,Z,"f")&&this._emit("toolCallCreated",eV(this,Z,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eJ(this,es,void 0,"f"),"tool_calls"==e.data.step_details.type&&eV(this,Z,"f")&&(this._emit("toolCallDone",eV(this,Z,"f")),eJ(this,Z,void 0,"f")),this._emit("runStepDone",e.data,t)}},eo=function(e){eV(this,X,"f").push(e),this._emit("event",e)},el=function(e){switch(e.event){case"thread.run.step.created":return eV(this,K,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eV(this,K,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=H.accumulateDelta(t,s.delta);eV(this,K,"f")[e.data.id]=n}return eV(this,K,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eV(this,K,"f")[e.data.id]=e.data}if(eV(this,K,"f")[e.data.id])return eV(this,K,"f")[e.data.id];throw Error("No snapshot available")},ec=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=eV(this,F,"m",eh).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},eh=function(e,t){return H.accumulateDelta(t,e)},eu=function(e){switch(eJ(this,et,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":eJ(this,z,e.data,"f"),eV(this,Z,"f")&&(this._emit("toolCallDone",eV(this,Z,"f")),eJ(this,Z,void 0,"f"))}};class sK extends st{constructor(){super(...arguments),this.steps=new sF(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(sr`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(sr`/threads/${n}/runs/${e}`,{...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(sr`/threads/${n}/runs/${e}`,{body:r,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(sr`/threads/${e}/runs`,tz,{query:t,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(sr`/threads/${n}/runs/${e}/cancel`,{...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return sX.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=sk([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:a}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await tc(i);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return sX.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(sr`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return sX.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sK.Steps=sF;class sJ extends st{constructor(){super(...arguments),this.runs=new sK(this._client),this.messages=new sU(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(sr`/threads/${e}`,{...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(sr`/threads/${e}`,{body:t,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(sr`/threads/${e}`,{...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sX.createThreadAssistantStream(e,this._client.beta.threads,t)}}sJ.Runs=sK,sJ.Messages=sU;class sV extends st{constructor(){super(...arguments),this.realtime=new sL(this._client),this.chatkit=new sW(this._client),this.assistants=new sj(this._client),this.threads=new sJ(this._client)}}sV.Realtime=sL,sV.ChatKit=sW,sV.Assistants=sj,sV.Threads=sJ;class sz extends st{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sG extends st{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(sr`/containers/${n}/files/${e}/content`,{...s,headers:sk([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sQ extends st{constructor(){super(...arguments),this.content=new sG(this._client)}create(e,t,s){return this._client.post(sr`/containers/${e}/files`,t2({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(sr`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(sr`/containers/${e}/files`,tz,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(sr`/containers/${n}/files/${e}`,{...s,headers:sk([{Accept:"*/*"},s?.headers])})}}sQ.Content=sG;class sY extends st{constructor(){super(...arguments),this.files=new sQ(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(sr`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tz,{query:e,...t})}delete(e,t){return this._client.delete(sr`/containers/${e}`,{...t,headers:sk([{Accept:"*/*"},t?.headers])})}}sY.Files=sQ;class sZ extends st{create(e,t,s){let{include:n,...r}=t;return this._client.post(sr`/conversations/${e}/items`,{query:{include:n},body:r,...s})}retrieve(e,t,s){let{conversation_id:n,...r}=t;return this._client.get(sr`/conversations/${n}/items/${e}`,{query:r,...s})}list(e,t={},s){return this._client.getAPIList(sr`/conversations/${e}/items`,tG,{query:t,...s})}delete(e,t,s){let{conversation_id:n}=t;return this._client.delete(sr`/conversations/${n}/items/${e}`,s)}}class s0 extends st{constructor(){super(...arguments),this.items=new sZ(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(sr`/conversations/${e}`,t)}update(e,t,s){return this._client.post(sr`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete(sr`/conversations/${e}`,t)}}s0.Items=sZ;class s1 extends st{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&tD(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(tD(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}})(t)}),e)))}}class s2 extends st{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(sr`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(sr`/evals/${n}/runs/${e}/output_items`,tz,{query:r,...s})}}class s4 extends st{constructor(){super(...arguments),this.outputItems=new s2(this._client)}create(e,t,s){return this._client.post(sr`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(sr`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(sr`/evals/${e}/runs`,tz,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(sr`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(sr`/evals/${n}/runs/${e}`,s)}}s4.OutputItems=s2;class s3 extends st{constructor(){super(...arguments),this.runs=new s4(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(sr`/evals/${e}`,t)}update(e,t,s){return this._client.post(sr`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tz,{query:e,...t})}delete(e,t){return this._client.delete(sr`/evals/${e}`,t)}}s3.Runs=s4;class s5 extends st{create(e,t){return this._client.post("/files",t2({body:e,...t},this._client))}retrieve(e,t){return this._client.get(sr`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tz,{query:e,...t})}delete(e,t){return this._client.delete(sr`/files/${e}`,t)}content(e,t){return this._client.get(sr`/files/${e}/content`,{...t,headers:sk([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),a=await this.retrieve(e);for(;!a.status||!n.has(a.status);)if(await tc(t),a=await this.retrieve(e),Date.now()-r>s)throw new e2({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}}class s8 extends st{}class s6 extends st{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class s9 extends st{constructor(){super(...arguments),this.graders=new s6(this._client)}}s9.Graders=s6;class s7 extends st{create(e,t,s){return this._client.getAPIList(sr`/fine_tuning/checkpoints/${e}/permissions`,tV,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(sr`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(sr`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class ne extends st{constructor(){super(...arguments),this.permissions=new s7(this._client)}}ne.Permissions=s7;class nt extends st{list(e,t={},s){return this._client.getAPIList(sr`/fine_tuning/jobs/${e}/checkpoints`,tz,{query:t,...s})}}class ns extends st{constructor(){super(...arguments),this.checkpoints=new nt(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(sr`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tz,{query:e,...t})}cancel(e,t){return this._client.post(sr`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(sr`/fine_tuning/jobs/${e}/events`,tz,{query:t,...s})}pause(e,t){return this._client.post(sr`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(sr`/fine_tuning/jobs/${e}/resume`,t)}}ns.Checkpoints=nt;class nn extends st{constructor(){super(...arguments),this.methods=new s8(this._client),this.jobs=new ns(this._client),this.checkpoints=new ne(this._client),this.alpha=new s9(this._client)}}nn.Methods=s8,nn.Jobs=ns,nn.Checkpoints=ne,nn.Alpha=s9;class nr extends st{}class na extends st{constructor(){super(...arguments),this.graderModels=new nr(this._client)}}na.GraderModels=nr;class ni extends st{createVariation(e,t){return this._client.post("/images/variations",t2({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",t2({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class no extends st{retrieve(e,t){return this._client.get(sr`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tV,e)}delete(e,t){return this._client.delete(sr`/models/${e}`,t)}}class nl extends st{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class nc extends st{accept(e,t,s){return this._client.post(sr`/realtime/calls/${e}/accept`,{body:t,...s,headers:sk([{Accept:"*/*"},s?.headers])})}hangup(e,t){return this._client.post(sr`/realtime/calls/${e}/hangup`,{...t,headers:sk([{Accept:"*/*"},t?.headers])})}refer(e,t,s){return this._client.post(sr`/realtime/calls/${e}/refer`,{body:t,...s,headers:sk([{Accept:"*/*"},s?.headers])})}reject(e,t={},s){return this._client.post(sr`/realtime/calls/${e}/reject`,{body:t,...s,headers:sk([{Accept:"*/*"},s?.headers])})}}class nh extends st{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class nu extends st{constructor(){super(...arguments),this.clientSecrets=new nh(this._client),this.calls=new nc(this._client)}}function nd(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var s,n;let r=(s=e.tools??[],n=t.name,s.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:r?.$brand==="auto-parseable-tool"?r.$parseRaw(t.arguments):r?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,n;return"output_text"===e.type?{...e,parsed:(s=t,n=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(n):JSON.parse(n))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||np(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function np(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}nu.ClientSecrets=nh,nu.Calls=nc;class nf extends sf{constructor(e){super(),ed.add(this),ep.set(this,void 0),ef.set(this,void 0),em.set(this,void 0),eJ(this,ep,e,"f")}static createResponse(e,t,s){let n=new nf(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n,r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eV(this,ed,"m",eg).call(this);let a=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))eV(this,ed,"m",ey).call(this,r,a);if(n.controller.signal?.aborted)throw new e0;return eV(this,ed,"m",ew).call(this)}[(ep=new WeakMap,ef=new WeakMap,em=new WeakMap,ed=new WeakSet,eg=function(){this.ended||eJ(this,ef,void 0,"f")},ey=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=eV(this,ed,"m",e_).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eY(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eY(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eY(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eY(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},ew=function(){if(this.ended)throw new eY("stream has ended, this shouldn't happen");let e=eV(this,ef,"f");if(!e)throw new eY("request ended without sending any events");eJ(this,ef,void 0,"f");let t=function(e,t){var s;return t&&(s=t,so(s.text?.format))?nd(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,eV(this,ep,"f"));return eJ(this,em,t,"f"),t},e_=function(e){let t=eV(this,ef,"f");if(!t){if("response.created"!==e.type)throw new eY(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eJ(this,ef,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eY(`missing output at index ${e.output_index}`);let n=s.type,r=e.part;"message"===n&&"reasoning_text"!==r.type?s.content.push(r):"reasoning"===n&&"reasoning_text"===r.type&&(s.content||(s.content=[]),s.content.push(r));break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eY(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eY(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eY(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eY(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.reasoning_text.delta":{let s=t.output[e.output_index];if(!s)throw new eY(`missing output at index ${e.output_index}`);if("reasoning"===s.type){let t=s.content?.[e.content_index];if(!t)throw new eY(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new eY(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":eJ(this,ef,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=eV(this,em,"f");if(!e)throw new eY("stream ended without producing a ChatCompletion");return e}}class nm extends st{list(e,t={},s){return this._client.getAPIList(sr`/responses/${e}/input_items`,tz,{query:t,...s})}}class ng extends st{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class ny extends st{constructor(){super(...arguments),this.inputItems=new nm(this._client),this.inputTokens=new ng(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&np(e),e))}retrieve(e,t={},s){return this._client.get(sr`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&np(e),e))}delete(e,t){return this._client.delete(sr`/responses/${e}`,{...t,headers:sk([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>nd(t,e))}stream(e,t){return nf.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(sr`/responses/${e}/cancel`,t)}}ny.InputItems=nm,ny.InputTokens=ng;class nw extends st{create(e,t,s){return this._client.post(sr`/uploads/${e}/parts`,t2({body:t,...s},this._client))}}class n_ extends st{constructor(){super(...arguments),this.parts=new nw(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(sr`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(sr`/uploads/${e}/complete`,{body:t,...s})}}n_.Parts=nw;let nb=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class nv extends st{create(e,t,s){return this._client.post(sr`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(sr`/vector_stores/${n}/file_batches/${e}`,{...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(sr`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(sr`/vector_stores/${n}/file_batches/${e}/files`,tz,{query:r,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=sk([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:a}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await tc(i);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),a=this._client,i=t.values(),o=[...s];async function l(e){for(let t of e){let e=await a.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(i).map(l);return await nb(c),await this.createAndPoll(e,{file_ids:o})}}class nx extends st{create(e,t,s){return this._client.post(sr`/vector_stores/${e}/files`,{body:t,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(sr`/vector_stores/${n}/files/${e}`,{...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(sr`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(sr`/vector_stores/${e}/files`,tz,{query:t,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(sr`/vector_stores/${n}/files/${e}`,{...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=sk([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),a=r.data;switch(a.status){case"in_progress":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await tc(i);break;case"failed":case"completed":return a}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(sr`/vector_stores/${n}/files/${e}/content`,tV,{...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class nA extends st{constructor(){super(...arguments),this.files=new nx(this._client),this.fileBatches=new nv(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(sr`/vector_stores/${e}`,{...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(sr`/vector_stores/${e}`,{body:t,...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tz,{query:e,...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(sr`/vector_stores/${e}`,{...t,headers:sk([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(sr`/vector_stores/${e}/search`,tV,{body:t,method:"post",...s,headers:sk([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}nA.Files=nx,nA.FileBatches=nv;class nS extends st{create(e,t){return this._client.post("/videos",t1({body:e,...t},this._client))}retrieve(e,t){return this._client.get(sr`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",tG,{query:e,...t})}delete(e,t){return this._client.delete(sr`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get(sr`/videos/${e}/content`,{query:t,...s,headers:sk([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(e,t,s){return this._client.post(sr`/videos/${e}/remix`,t1({body:t,...s},this._client))}}class n$ extends st{constructor(){super(...arguments),eb.add(this)}async unwrap(e,t,s=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,s,n),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,n=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");eV(this,eb,"m",ev).call(this,s);let r=sk([t]).values,a=eV(this,eb,"m",ex).call(this,r,"webhook-signature"),i=eV(this,eb,"m",ex).call(this,r,"webhook-timestamp"),o=eV(this,eb,"m",ex).call(this,r,"webhook-id"),l=parseInt(i,10);if(isNaN(l))throw new tn("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new tn("Webhook timestamp is too old");if(l>c+n)throw new tn("Webhook timestamp is too new");let h=a.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),u=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=o?`${o}.${i}.${e}`:`${i}.${e}`,p=await crypto.subtle.importKey("raw",u,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of h)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",p,t,new TextEncoder().encode(d)))return}catch{continue}throw new tn("The given webhook signature does not match the expected signature")}}eb=new WeakSet,ev=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},ex=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s},e.i(77383);class nR{constructor({baseURL:e=sH("OPENAI_BASE_URL"),apiKey:t=sH("OPENAI_API_KEY"),organization:s=sH("OPENAI_ORG_ID")??null,project:n=sH("OPENAI_PROJECT_ID")??null,webhookSecret:r=sH("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(eA.add(this),e$.set(this,void 0),this.completions=new sz(this),this.chat=new sI(this),this.embeddings=new s1(this),this.files=new s5(this),this.images=new ni(this),this.audio=new sT(this),this.moderations=new nl(this),this.models=new no(this),this.fineTuning=new nn(this),this.graders=new na(this),this.vectorStores=new nA(this),this.webhooks=new n$(this),this.beta=new sV(this),this.batches=new sN(this),this.uploads=new n_(this),this.responses=new ny(this),this.realtime=new nu(this),this.conversations=new s0(this),this.evals=new s3(this),this.containers=new sY(this),this.videos=new nS(this),void 0===t)throw new eY("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const i={apiKey:t,organization:s,project:n,webhookSecret:r,...a,baseURL:e||"https://api.openai.com/v1"};i.dangerouslyAllowBrowser,this.baseURL=i.baseURL,this.timeout=i.timeout??eS.DEFAULT_TIMEOUT,this.logger=i.logger??console;const o="warn";this.logLevel=o,this.logLevel=tC(i.logLevel,"ClientOptions.logLevel",this)??tC(sH("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eJ(this,e$,ty,"f"),this._options=i,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=s,this.project=n,this.webhookSecret=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return sk([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n=e,r=function(e=tR){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||tR.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=tw;if(void 0!==e.format){if(!tv(tb,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=tb[n],a=tR.filter;if(("function"==typeof e.filter||ta(e.filter))&&(a=e.filter),t=e.arrayFormat&&e.arrayFormat in tS?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":tR.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let i=void 0===e.allowDots?!0==!!e.encodeDotInKeys||tR.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:tR.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:tR.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:tR.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?tR.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:tR.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:tR.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:tR.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:tR.encodeValuesOnly,filter:a,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:tR.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:tR.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:tR.strictNullHandling}}(t);"function"==typeof r.filter?n=(0,r.filter)("",n):ta(r.filter)&&(s=r.filter);let a=[];if("object"!=typeof n||null===n)return"";let i=tS[r.arrayFormat],o="comma"===i&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];r.skipNulls&&null===n[t]||t$(a,function e(t,s,n,r,a,i,o,l,c,h,u,d,p,f,m,g,y,w){var _,b;let v,x=t,A=w,S=0,$=!1;for(;void 0!==(A=A.get(tI))&&!$;){let e=A.get(t);if(S+=1,void 0!==e)if(e===S)throw RangeError("Cyclic object value");else $=!0;void 0===A.get(tI)&&(S=0)}if("function"==typeof h?x=h(s,x):x instanceof Date?x=p?.(x):"comma"===n&&ta(x)&&(x=tA(x,function(e){return e instanceof Date?p?.(e):e})),null===x){if(i)return c&&!g?c(s,tR.encoder,y,"key",f):s;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,tR.encoder,y,"key",f);return[m?.(e)+"="+m?.(c(x,tR.encoder,y,"value",f))]}return[m?.(s)+"="+m?.(String(x))]}let R=[];if(void 0===x)return R;if("comma"===n&&ta(x))g&&c&&(x=tA(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(ta(h))v=h;else{let e=Object.keys(x);v=u?e.sort(u):e}let I=l?String(s).replace(/\./g,"%2E"):String(s),O=r&&ta(x)&&1===x.length?I+"[]":I;if(a&&ta(x)&&0===x.length)return O+"[]";for(let s=0;s<v.length;++s){let _=v[s],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let A=d&&l?_.replace(/\./g,"%2E"):_,$=ta(x)?"function"==typeof n?n(O,A):O:O+(d?"."+A:"["+A+"]");w.set(t,S);let I=new WeakMap;I.set(tI,w),t$(R,e(b,$,n,r,a,i,o,l,"comma"===n&&g&&ta(x)?null:c,h,u,d,p,f,m,g,y,I))}return R}(n[t],t,i,o,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=a.join(r.delimiter),h=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${th}`}defaultIdempotencyKey(){return`stainless-node-retry-${ez()}`}makeStatusError(e,t,s,n){return eZ.generate(e,t,s,n)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof eY)throw e;throw new eY(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new eY(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,s){let n=!eV(this,eA,"m",eR).call(this)&&s||this.baseURL,r=new URL(tr.test(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(a)&&(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tX(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:a,url:i,timeout:o}=await this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(a,{url:i,options:n});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(tD(this).debug(`[${l}] sending request`,tL({retryOfRequestLogID:s,method:n.method,url:i,options:n,headers:a.headers})),n.signal?.aborted)throw new e0;let u=new AbortController,d=await this.fetchWithTimeout(i,a,o,u).catch(eQ),p=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new e0;let r=eG(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tD(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),tD(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,tL({retryOfRequestLogID:s,url:i,durationMs:p-h,message:d.message})),this.retryRequest(n,t,s??l);if(tD(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),tD(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,tL({retryOfRequestLogID:s,url:i,durationMs:p-h,message:d.message})),r)throw new e2;throw new e1({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${a.method} ${i} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-h}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await tg(d.body),tD(this).info(`${m} - ${e}`),tD(this).debug(`[${l}] response error (${e})`,tL({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";tD(this).info(`${m} - ${r}`);let a=await d.text().catch(e=>eQ(e).message),i=(e=>{try{return JSON.parse(e)}catch(e){return}})(a),o=i?void 0:a;throw tD(this).debug(`[${l}] response error (${r})`,tL({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-h})),this.makeStatusError(d.status,i,o,d.headers)}return tD(this).info(m),tD(this).debug(`[${l}] response start`,tL({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),{response:d,options:n,controller:u,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tJ(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:a,...i}=t||{};r&&r.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...i};a&&(c.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,n){let r,a=n?.get("retry-after-ms");if(a){let e=parseFloat(a);Number.isNaN(e)||(r=e)}let i=n?.get("retry-after");if(i&&!r){let e=parseFloat(i);r=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await tc(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:a,defaultBaseURL:i}=s,o=this.buildURL(r,a,i);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eY(`${e} must be an integer`);if(t<0)throw new eY(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),h=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:h,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:s,bodyHeaders:n,retryCount:r}){let a={};this.idempotencyHeader&&"get"!==s&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let i=sk([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...t??(t=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":td(Deno.build.os),"X-Stainless-Arch":tu(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":td(globalThis.process.platform??"unknown"),"X-Stainless-Arch":tu(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sk([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:tf(e)}:eV(this,e$,"f").call(this,{body:e,headers:s})}}eS=nR,e$=new WeakMap,eA=new WeakSet,eR=function(){return"https://api.openai.com/v1"!==this.baseURL},nR.OpenAI=eS,nR.DEFAULT_TIMEOUT=6e5,nR.OpenAIError=eY,nR.APIError=eZ,nR.APIConnectionError=e1,nR.APIConnectionTimeoutError=e2,nR.APIUserAbortError=e0,nR.NotFoundError=e8,nR.ConflictError=e6,nR.RateLimitError=e7,nR.BadRequestError=e4,nR.AuthenticationError=e3,nR.InternalServerError=te,nR.PermissionDeniedError=e5,nR.UnprocessableEntityError=e9,nR.InvalidWebhookSignatureError=tn,nR.toFile=t7,nR.Completions=sz,nR.Chat=sI,nR.Embeddings=s1,nR.Files=s5,nR.Images=ni,nR.Audio=sT,nR.Moderations=nl,nR.Models=no,nR.FineTuning=nn,nR.Graders=na,nR.VectorStores=nA,nR.Webhooks=n$,nR.Beta=sV,nR.Batches=sN,nR.Uploads=n_,nR.Responses=ny,nR.Realtime=nu,nR.Conversations=s0,nR.Evals=s3,nR.Containers=sY,nR.Videos=nS;let nI=null,nO=`You are the ChimiaDAO Assistant, an AI specialized in helping scientists query and understand decentralized scientific data from the PoX (Proof-of-X) network.

**Context:**
- PoX is a blockchain-based reputation system for scientific experiments
- Experiments (HPLC, Air Quality, NMR) are stored on Filecoin with hashes on-chain
- The Graph indexes experiment metadata for fast queries
- Users can have private local data AND public on-chain data

**Your Capabilities:**
1. Query The Graph subgraph for experiment metadata
2. Explain blockchain concepts (CIDs, hashes, reputation scores)
3. Help interpret HPLC chromatograms and scientific data
4. Provide information about Filecoin storage deals
5. Answer questions about the PoX protocol and fraud proofs

**Tone:**
- Precise and scientific, but approachable
- Use technical terms when appropriate, but explain them
- Format numbers with proper units (mAU, ppb, g/m\xb3)
- Reference blockchain data when available (CIDs, addresses, block numbers)

**Data Access:**
- You receive real-time context about experiments from The Graph
- CIDs are Filecoin piece CIDs (bafkzcib... format)
- Difficulty scores: HPLC (7-14), Air Quality (15-24), NMR (25-70)
- Reputation decays over time (=0.01/day)

**Response Format:**
- Keep responses concise (2-3 paragraphs max)
- Use code formatting for CIDs, hashes, addresses
- Provide specific data when available (don't be vague)
- If data is missing, say so clearly

Remember: You're helping scientists verify and understand their decentralized lab notebook.`;async function nk(e,t,s={}){var n;let r,a=function(){if(!nI){let e=process.env.OPENAI_API_KEY;if(!e)throw Error("OPENAI_API_KEY is not set. Please add it to your .env.local file. Get your API key from: https://platform.openai.com/api-keys");nI=new nR({apiKey:e})}return nI}(),{model:i=process.env.OPENAI_MODEL||"gpt-4o-mini",temperature:o=.7,maxTokens:l=500,stream:c=!1}=s,h=nO;t&&(h+=`

**Current Context:**
${r=[],(n=t).experiments&&Array.isArray(n.experiments)&&(r.push(`**Recent Experiments (${n.experiments.length}):**`),n.experiments.slice(0,5).forEach((e,t)=>{r.push(`${t+1}. ${e.sampleId||e.id} - Type: ${e.type}, Difficulty: ${e.difficulty}, CID: ${e.cid?.slice(0,20)}...`)})),n.stats&&(r.push(`
**Network Stats:**`),r.push(`Total experiments: ${n.stats.totalExperiments||0}`),r.push(`HPLC: ${n.stats.hplcCount||0}, Air Quality: ${n.stats.airQualityCount||0}, NMR: ${n.stats.nmrCount||0}`)),n.hplc&&(r.push(`
**Active HPLC Data:**`),r.push(`Sample: ${n.hplc.sampleId}`),r.push(`Method: ${n.hplc.method}`),r.push(`Status: ${n.hplc.metrics?.status||"Unknown"}`)),r.join("\n")}`);let u=[{role:"system",content:h},...e.map(e=>({role:e.role,content:e.content}))];try{let e=await a.chat.completions.create({model:i,messages:u,temperature:o,max_tokens:l,stream:c});if(c)return e;return e.choices[0]?.message?.content||"No response generated."}catch(e){if(console.error("[LLM] Query failed:",e.message),401===e.status)throw Error("Invalid OpenAI API key. Please check your .env.local file.");if(429===e.status)throw Error("OpenAI rate limit exceeded. Please try again in a moment.");if(500===e.status)throw Error("OpenAI service error. Please try again later.");throw Error(`LLM query failed: ${e.message}`)}}var nE=e.i(18386),nP=e.i(9712);async function nC(e){let t={"X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","Referrer-Policy":"strict-origin-when-cross-origin"};try{if(!process.env.OPENAI_API_KEY)return eX.NextResponse.json({error:"LLM not configured",message:"OpenAI API key is missing. Add OPENAI_API_KEY to .env.local"},{status:503,headers:t});let s=(0,eK.headers)().get("x-forwarded-for"),n=s?s.split(",")[0].trim():"unknown";if(!(0,nP.checkRateLimit)(`api:chat:${n}`,20,6e4))return eX.NextResponse.json({error:"Rate limit exceeded",message:"Too many chat requests. Please wait before sending more.",retryAfter:60},{status:429,headers:{...t,"Retry-After":"60"}});let{messages:r,includeGraphContext:a=!0}=await e.json();if(!r||!Array.isArray(r))return eX.NextResponse.json({error:"Invalid request",message:"messages array is required"},{status:400,headers:t});let i=null;if(a)try{let[e,t]=await Promise.all([(0,nE.fetchUnifiedExperiments)(),(0,nE.fetchDashboardStats)()]);i={experiments:e.slice(0,10),stats:t}}catch(e){console.warn("[Chat API] Failed to fetch Graph context:",e)}let o=Date.now(),l=await nk(r,i,{stream:!1,maxTokens:500,temperature:.7}),c=Date.now()-o;return eX.NextResponse.json({response:l,duration:c,graphContext:i?{experimentCount:i.experiments?.length||0,totalExperiments:i.stats?.totalExperiments||0}:null,timestamp:Date.now()},{headers:t})}catch(n){console.error("[Chat API] Error:",n.message);let e="Chat service temporarily unavailable. Please try again.",s=500;return n.message.includes("API key")?(e="Chat service is not configured. Please contact support.",s=503):n.message.includes("rate limit")?(e="OpenAI rate limit reached. Please try again in a moment.",s=429):n.message.includes("timeout")&&(e="Request timeout. Please try a shorter query.",s=504),eX.NextResponse.json({error:"Chat error",message:e,timestamp:Date.now()},{status:s,headers:t})}}e.s(["POST",()=>nC,"dynamic",0,"force-dynamic","revalidate",0,0],45420);var nT=e.i(45420);let nN=new eI.AppRouteRouteModule({definition:{kind:eO.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ETHGlobalBuenosAires/blockchain-status-plotter-current/app/api/chat/route.ts",nextConfigOutput:"",userland:nT}),{workAsyncStorage:nj,workUnitAsyncStorage:nM,serverHooks:nD}=nN;function nL(){return(0,ek.patchFetch)({workAsyncStorage:nj,workUnitAsyncStorage:nM})}async function nB(e,t,s){nN.isDev&&(0,eE.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/chat/route";n=n.replace(/\/index$/,"")||"/";let r=await nN.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!r)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:a,params:i,nextConfig:o,parsedUrl:l,isDraftMode:c,prerenderManifest:h,routerServerContext:u,isOnDemandRevalidate:d,revalidateOnlyGenerated:p,resolvedPathname:f,clientReferenceManifest:m,serverActionsManifest:g}=r,y=(0,eN.normalizeAppPath)(n),w=!!(h.dynamicRoutes[y]||h.routes[f]),_=async()=>((null==u?void 0:u.render404)?await u.render404(e,t,l,!1):t.end("This page could not be found"),null);if(w&&!c){let e=!!h.routes[f],t=h.dynamicRoutes[y];if(t&&!1===t.fallback&&!e){if(o.experimental.adapterPath)return await _();throw new eF.NoFallbackError}}let b=null;!w||nN.isDev||c||(b="/index"===(b=f)?"/":b);let v=!0===nN.isDev||!w,x=w&&!v;g&&m&&(0,eC.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:m,serverActionsManifest:g,serverModuleMap:(0,eT.createServerModuleMap)({serverActionsManifest:g})});let A=e.method||"GET",S=(0,eP.getTracer)(),$=S.getActiveScopeSpan(),R={params:i,prerenderManifest:h,renderOpts:{experimental:{authInterrupts:!!o.experimental.authInterrupts},cacheComponents:!!o.cacheComponents,supportsDynamicResponse:v,incrementalCache:(0,eE.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:o.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,s,n)=>nN.onRequestError(e,t,n,u)},sharedContext:{buildId:a}},I=new ej.NodeNextRequest(e),O=new ej.NodeNextResponse(t),k=eM.NextRequestAdapter.fromNodeNextRequest(I,(0,eM.signalFromNodeResponse)(t));try{let r=async e=>nN.handle(k,R).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let s=S.getRootSpanAttributes();if(!s)return;if(s.get("next.span_type")!==eD.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${s.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=s.get("next.route");if(r){let t=`${A} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${A} ${n}`)}),a=!!(0,eE.getRequestMeta)(e,"minimalMode"),i=async i=>{var l,f;let m=async({previousCacheEntry:o})=>{try{if(!a&&d&&p&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await r(i);e.fetchMetrics=R.renderOpts.fetchMetrics;let l=R.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let c=R.renderOpts.collectedTags;if(!w)return await (0,eB.sendResponse)(I,O,n,R.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,eq.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[eU.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let s=void 0!==R.renderOpts.collectedRevalidate&&!(R.renderOpts.collectedRevalidate>=eU.INFINITE_CACHE)&&R.renderOpts.collectedRevalidate,r=void 0===R.renderOpts.collectedExpire||R.renderOpts.collectedExpire>=eU.INFINITE_CACHE?void 0:R.renderOpts.collectedExpire;return{value:{kind:eH.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:s,expire:r}}}}catch(t){throw(null==o?void 0:o.isStale)&&await nN.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,eL.getRevalidateReason)({isStaticGeneration:x,isOnDemandRevalidate:d})},u),t}},g=await nN.handleResponse({req:e,nextConfig:o,cacheKey:b,routeKind:eO.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:h,isRoutePPREnabled:!1,isOnDemandRevalidate:d,revalidateOnlyGenerated:p,responseGenerator:m,waitUntil:s.waitUntil,isMinimalMode:a});if(!w)return null;if((null==g||null==(l=g.value)?void 0:l.kind)!==eH.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==g||null==(f=g.value)?void 0:f.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",d?"REVALIDATED":g.isMiss?"MISS":g.isStale?"STALE":"HIT"),c&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,eq.fromNodeOutgoingHttpHeaders)(g.value.headers);return a&&w||y.delete(eU.NEXT_CACHE_TAGS_HEADER),!g.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,eW.getCacheControlHeader)(g.cacheControl)),await (0,eB.sendResponse)(I,O,new Response(g.value.body,{headers:y,status:g.value.status||200})),null};$?await i($):await S.withPropagatedContext(e.headers,()=>S.trace(eD.BaseServerSpan.handleRequest,{spanName:`${A} ${n}`,kind:eP.SpanKind.SERVER,attributes:{"http.method":A,"http.target":e.url}},i))}catch(t){if(t instanceof eF.NoFallbackError||await nN.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,eL.getRevalidateReason)({isStaticGeneration:x,isOnDemandRevalidate:d})}),w)throw t;return await (0,eB.sendResponse)(I,O,new Response(null,{status:500})),null}}e.s(["handler",()=>nB,"patchFetch",()=>nL,"routeModule",()=>nN,"serverHooks",()=>nD,"workAsyncStorage",()=>nj,"workUnitAsyncStorage",()=>nM],27155)}];

//# sourceMappingURL=0ea95_next_dist_esm_build_templates_app-route_dbfa6b1e.js.map