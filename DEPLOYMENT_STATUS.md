# PoX Deployment Status

**Last Updated**: November 22, 2025 23:55 UTC

## âœ… Completed

### Smart Contracts (Filecoin Calibration - Chain ID 314159)

- [x] Reputation deployed: `0xfbf4854d38c77bd4b74fb0c65d9c249fd7bdefa1`
- [x] PoXRegistry deployed: `0xa6fa61924f06db9a84b92182b69f5c08f3176554`
- [x] ChallengeManager deployed: `0x6e80a987049965127f1eb69cc49fb4460aeb5e8b`
- [x] Contracts authorized (Registry + ChallengeManager can adjust reputation)

### The Graph Subgraph

- [x] Graph CLI installed (v0.80.0 for Node 20.15 compatibility)
- [x] package.json created with dependencies
- [x] subgraph.yaml fixed (network: calibration, correct address, correct events)
- [x] schema.graphql updated to match contract fields
- [x] mapping.ts rewritten for ExperimentRegistered event
- [x] ABI copied to subgraph/abis/PoXRegistry.json
- [x] Codegen run successfully
- [x] Build completed successfully (WASM compiled)

## ğŸ”´ TODO (Before Demo - 12 Hours)

### The Graph Deployment

1. **Get Studio Deploy Key**
   - Go to https://thegraph.com/studio/
   - Sign in with wallet
   - Create new subgraph named "pox" (or use existing)
   - Copy deploy key

2. **Authenticate**
   ```bash
   cd subgraph
   npx @graphprotocol/graph-cli@0.80.0 auth --studio <YOUR_DEPLOY_KEY>
   ```

3. **Deploy**
   ```bash
   npx @graphprotocol/graph-cli@0.80.0 deploy --studio pox
   ```

4. **Verify Indexing**
   - Check Studio dashboard for sync status
   - Wait for indexing to catch up to current block
   - Test with example query (see subgraph/README.md)

### Integration Testing

- [ ] Submit test experiment via PoXRegistry.registerExperiment()
- [ ] Verify event emission on block explorer
- [ ] Confirm subgraph indexes the event
- [ ] Query subgraph for test experiment
- [ ] Verify all fields populated correctly

### Frontend (if applicable)

- [ ] Update frontend with subgraph endpoint
- [ ] Test experiment submission flow
- [ ] Display indexed experiments
- [ ] Show reputation scores

## ğŸ“ Notes

### Current Network
- **Name**: Filecoin Calibration
- **Chain ID**: 314159
- **RPC**: (check your env vars)
- **Explorer**: https://calibration.filfox.info/

### Subgraph Configuration
- **Network**: `calibration`
- **Start Block**: 3847000 (estimated - adjust if contracts deployed earlier/later)
- **Contract**: PoXRegistry at `0xa6fa61924f06db9a84b92182b69f5c08f3176554`

### Known Issues
- Node.js 20.15.1 requires using Graph CLI v0.80.0 (newer versions need 20.18.1+)
- Filecoin Calibration may have slower block times - factor in sync delays
- Subgraph Studio free tier has usage limits - monitor during testing

### Quick Commands Reference

```bash
# Build subgraph
cd subgraph && npx @graphprotocol/graph-cli@0.80.0 build

# Deploy to Studio
npx @graphprotocol/graph-cli@0.80.0 deploy --studio pox

# Submit test experiment (from root)
forge script script/RegisterDataset.s.sol --rpc-url $RPC --broadcast --private-key $PK
```

### Files Modified for Graph Support

```
subgraph/
â”œâ”€â”€ package.json          (created)
â”œâ”€â”€ README.md             (created)
â”œâ”€â”€ subgraph.yaml         (fixed network + address + events)
â”œâ”€â”€ schema.graphql        (simplified to match contract)
â”œâ”€â”€ src/mapping.ts        (rewritten for ExperimentRegistered)
â”œâ”€â”€ abis/
â”‚   â””â”€â”€ PoXRegistry.json  (copied from out/)
â”œâ”€â”€ generated/            (auto-generated by codegen)
â””â”€â”€ build/                (WASM output from build)
```

## ğŸ¯ Success Criteria

Before demo:
1. Subgraph deployed and synced to current block
2. At least one test experiment indexed
3. Query returns correct experiment data
4. All fields match on-chain event values
5. Frontend can fetch and display experiments (if applicable)

## ğŸš€ Next Steps After Deployment

1. Monitor sync status in Studio
2. Adjust startBlock if needed (to reduce sync time)
3. Test with multiple experiments
4. Set up frontend integration
5. Document API endpoints for judges/users
